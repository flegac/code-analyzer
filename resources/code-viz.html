<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Code Viz 3D</title>

    <script src="https://unpkg.com/chroma-js@2.4.2/chroma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>


    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css"/>

    <script src="https://unpkg.com/3d-force-graph"></script>

    <script src="web/relation.js"></script>
    <script src="web/custom-force.js"></script>

    <script src="web/graph.js"></script>
    <script src="web/graph-vertex-updater.js"></script>
    <script src="web/graph-edge-updater.js"></script>
    <script src="web/graph-group-updater.js"></script>
    <script src="web/graph-force-updater.js"></script>

    <script src="web/graph-controller.js"></script>
    <script src="web/tree-view.js"></script>
    <script src="web/table-view.js"></script>
    <script src="web/utils.js"></script>

    <link rel="stylesheet" href="web/style.css">
</head>
<body>

<script>
    var config = {
        settings: {
            // hasHeaders: false,
        },
        content: [{
            type: 'row',
            content: [
                {
                    type: 'component',
                    componentName: 'tree-view',
                    componentState: {label: 'Tree View'},
                    width: 20,
                },
                {
                    type: 'stack',
                    content: [
                        {
                            type: 'component',
                            componentName: 'graph-view',
                            componentState: {label: 'Graph View'}
                        },
                        {
                            type: 'component',
                            componentName: 'table-view',
                            componentState: {label: 'Table View'}
                        },
                    ]
                }]
        }]
    };

    const graph = new Graph();
    const tree = new TreeView();
    const controller = new GraphController(graph, tree);
    tree.onUpdate = groups => {
        controller.groups = groups;
        controller.rebuildGraph();
        // controller.updateGraph();

    };
    const table = new TableView();

    var myLayout = new GoldenLayout(config);
    myLayout.registerComponent('tree-view', function (container, componentState) {
        (async () => {
            let elt = container.getElement();
            elt.append(controller.gui.domElement);
            elt.append(tree.container);

            const hierarchy = await controller.hierarchy();
            tree.rebuild(hierarchy);
        })();
    });

    myLayout.registerComponent('graph-view', function (container, componentState) {
        container.getElement().append(graph.container);
    });

    myLayout.registerComponent('table-view', function (container, componentState) {
        (async () => {
            const data = await controller.moduleInfos();
            await table.rebuild(data);
            container.getElement().append(table.container);
        })();

    });


    window.addEventListener('DOMContentLoaded', () => controller.loadGraph());
    myLayout.init();

</script>

</body>
</html>
