<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Code Viz 3D</title>

    <script src="https://unpkg.com/chroma-js@2.4.2/chroma.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.20"></script>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css"/>

    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>

    <script src="web/utils.js"></script>
    <script src="web/relation.js"></script>
    <script src="web/custom-force.js"></script>

    <script src="web/graph.js"></script>
    <script src="web/graph-camera-controller.js"></script>
    <script src="web/graph-node-updater.js"></script>

    <script src="web/graph-edge-updater.js"></script>
    <script src="web/graph-edge-controller.js"></script>

    <script src="web/graph-group-updater.js"></script>
    <script src="web/graph-force-updater.js"></script>

    <script src="web/graph-updater.js"></script>
    <script src="web/graph-controller.js"></script>

    <script src="web/tree-view.js"></script>
    <script src="web/table-view.js"></script>

    <link rel="stylesheet" href="web/style.css">
</head>
<body>

<input type="file" id="file-browser" style="display: none" accept=".json"/>

<script>
    var config = {
        settings: {
            // hasHeaders: false,
        },
        content: [{
            type: 'row',
            content: [
                {
                    type: 'stack',
                    width: 15,
                    content: [
                        {
                            type: 'component',
                            componentName: 'graph-controller',
                            componentState: {label: 'Graph Controller'},
                        },
                        {
                            type: 'component',
                            componentName: 'tree-view',
                            componentState: {label: 'Tree View'},
                        },
                    ]
                },

                {
                    type: 'stack',
                    content: [
                        {
                            type: 'component',
                            componentName: 'graph-view',
                            componentState: {label: 'Graph View'}
                        },
                        {
                            type: 'component',
                            componentName: 'table-view',
                            componentState: {label: 'Table View'}
                        },
                    ]
                }]
        }]
    };

    const graph = new Graph();
    const tree = new TreeView();

    const updater = new GraphUpdater(graph, tree);
    const controller = new GraphController(updater);

    const edgeController = new GraphEdgeController(updater.edgeControl.params);
    edgeController.onChange = () => {
        updater.edgeControl.apply(graph);
    };

    tree.onUpdate = groups => {
        updater.groups = groups;
        updater.rebuildGraph();
        // controller.updateGraph();
    };
    const table = new TableView();

    var myLayout = new GoldenLayout(config);
    myLayout.registerComponent('graph-controller', function (container, componentState) {
        (async () => {
            let elt = container.getElement();
            elt.append(controller.container);
            elt.append(edgeController.container);
        })();
    })
    myLayout.registerComponent('tree-view', function (container, componentState) {
        (async () => {
            const hierarchy = await updater.hierarchy();
            tree.rebuild(hierarchy);
            container.getElement().append(tree.container);
        })();
    });

    myLayout.registerComponent('graph-view', function (container, componentState) {
        container.getElement().append(graph.container);
    });

    myLayout.registerComponent('table-view', function (container, componentState) {
        (async () => {
            const data = await updater.moduleInfos();
            await table.rebuild(data);
            container.getElement().append(table.container);
        })();

    });


    window.addEventListener('DOMContentLoaded', () => controller.updater.loadGraph());
    myLayout.init();

</script>

</body>
</html>
