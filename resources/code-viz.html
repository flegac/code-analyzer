<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Code Viz 3D</title>

    <script src="https://unpkg.com/chroma-js@2.4.2/chroma.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.20"></script>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css"/>

    <script src="https://unpkg.com/cash-dom"></script>
    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js/build/stats.min.js"></script>


    <script src="web/layout.js"></script>
    <script src="web/utils.js"></script>
    <script src="web/relation.js"></script>

    <script src="web/custom-force.js"></script>

    <script src="web/graph-filter.js"></script>
    <script src="web/graph-updater-dataset.js"></script>

    <script src="web/graph.js"></script>
    <script src="web/graph-controller-camera.js"></script>

    <script src="web/graph-updater.js"></script>
    <script src="web/graph-controller.js"></script>


    <script src="web/graph-node-renderer.js"></script>

    <script src="web/graph-updater-node.js"></script>
    <script src="web/graph-controller-node.js"></script>

    <script src="web/graph-updater-relation.js"></script>
    <script src="web/graph-controller-relation.js"></script>

    <script src="web/graph-updater-physics.js"></script>

    <script src="web/tree-view.js"></script>
    <script src="web/table-view.js"></script>

    <link rel="stylesheet" href="web/style.css">
</head>
<body>

<script>
  const stats = new Stats();
  stats.dom.classList.add('stats-panel');
  stats.showPanel(0); // 0 = FPS, 1 = MS, 2 = MB
  document.body.appendChild(stats.dom);


  function animate() {
    stats.begin();

    // ton code animé ici…

    stats.end();
    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
</script>

<input type="file" id="file-browser" style="display: none" accept=".json"/>
<script>

    const graph = new Graph();
    const tree = new TreeView();

    const updater = new GraphUpdater(graph, tree);
    const controller = new GraphController(updater);

    tree.onUpdate = groups => {
       console.log(groups);
    };
    const table = new TableView();

    LAYOUT.registerComponent('graph-controller', function (container, componentState) {
        (async () => {
            let elt = container.getElement();
            elt.append(controller.container);
            elt.append(controller.control.nodes.container);
            elt.append(controller.control.edges.container);
        })();
    })
    LAYOUT.registerComponent('tree-view', function (container, componentState) {
        (async () => {
            const graph = await updater.children.dataset.dependencies();
            tree.rebuild(graph.hierarchy());
            container.getElement().append(tree.container);
        })();
    });

    LAYOUT.registerComponent('graph-view', function (container, componentState) {
        container.getElement().append(graph.container);
    });

    LAYOUT.registerComponent('table-view', function (container, componentState) {
        (async () => {
            const data = await updater.children.dataset.moduleInfos();
            await table.rebuild(data);
            container.getElement().append(table.container);
        })();

    });


    $(() => controller.updater.loadGraph());
    LAYOUT.init();

</script>

</body>
</html>
