<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Code Viz 3D</title>

    <script type="importmap">
        {
            "imports": {
                "events": "./web/core/event-handler.js",
                "camera-controller": "./web/camera-controller.js",
                "tree-view": "./web/layout/tree-view.js",
                "table-view": "./web/layout/table-view.js",
                "graph-view": "./web/layout/graph-view.js",
                "global-app": "./web/global-app.js",
                "graph-controller": "./web/graph-controller.js",
                "render-debug": "./web/render-debug.js"
            }
        }
    </script>

    <script src="https://unpkg.com/chroma-js@2.4.2/chroma.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.20"></script>

    <!-- <script src="https://unpkg.com/cash-dom"></script> -->
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
    <link rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css"/>
    <link rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css"/>
    <link rel="stylesheet" href="web/style.css">

    <!-- 3d force graph -->
    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js/build/stats.min.js"></script>

    <!-- graphology -->
    <script src="https://cdn.jsdelivr.net/npm/graphology@0.21.0/dist/graphology.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/graphology-library@latest/dist/graphology-library.min.js"></script>
    <script src="web/graph/my-graph.js"></script>

    <!-- core -->
    <script src="web/core/utils.js"></script>
    <script src="web/view-config.js"></script>
    <script src="web/layout/layout.js"></script>
    <script src="web/graph/graph-filter.js"></script>

    <!-- dataset -->
    <script src="web/dataset-updater.js"></script>
    <script src="web/dataset-controller.js"></script>

    <!-- physics -->
    <script src="web/physics-updater.js"></script>
    <script src="web/physics-controller.js"></script>
    <script src="web/custom-force.js"></script>

    <!-- display -->
    <script src="web/display-node-updater.js"></script>
    <script src="web/display-updater.js"></script>
    <script src="web/display-controller.js"></script>

</head>
<body>
<input type="file" id="file-browser" style="display: none" accept=".json"/>

<script>
    const stats = new Stats();
    stats.dom.classList.add('stats-panel');
    stats.showPanel(0); // 0 = FPS, 1 = MS, 2 = MB
    document.body.appendChild(stats.dom);
    function animate() {
        stats.begin();
        stats.end();
        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
</script>
<script type="module">
    import { GlobalApp } from "global-app";
    import { GraphController } from "graph-controller";

    const updater = new GlobalApp();
    const layout = updater.layout;
    const controller = new GraphController(updater);

    const dependencies = await updater.dataset.dependencies();
    const moduleInfos = await updater.dataset.moduleInfos();

    await layout.table.rebuild(moduleInfos);

    loadLayout({
        'control-view': () => [
            controller.dataset.container, 
            controller.physics.container, 
            controller.display.container, 
            controller.container, 
        ],
        'tree-view': async () => {
            layout.tree.rebuild(MyGraph.hierarchy(dependencies));
            return [
                layout.tree.container
            ];
        },
        'graph-view': () => [
            layout.graph.container
        ],
        'table-view': async () => [
                layout.table.container
        ],
    });

    $(() => updater.loadGraph());
    $(() => {
        const $leftPanel = $('.lm_stack').first();
        const $mainPanel = $('.lm_stack').eq(1);
        $leftPanel.attr("id", "left-panel");


        const width = 250;
        const widthString = `${width}px`;

        $mainPanel.css({
            flex: "1 1 auto",
            width: "auto",
            minWidth: "0"
        });
        $mainPanel.parent().css({
            display: "flex"
        });

        $leftPanel.css({
            width: widthString,
            minWidth: widthString,
            maxWidth: widthString
        });

        $leftPanel.find('.lm_content').css({
            'overflow-y': 'auto',
            'height': '100%'
        });
    });
</script>

</body>
</html>
